@page "/shareables"
@using MegaSchool1.Components
@using MegaSchool1.Model
@using MegaSchool1.Model.Repository
@using MegaSchool1.Model.UI
@using MegaSchool1.Repository.Model
@using Content = MegaSchool1.Model.Content
@using OneOf
@using OneOf.Types
@inherits Components.ComponentBase
@inject Constants Constants
@inject UISettings UI
@inject NavigationManager NavigationManager
@inject Repository.Repository Repo

<MudStack Spacing="3">
    <MudCard>
        <MudCardContent>
            <MudStack Spacing="3">
                <MudSelect T="Content" Label="Shareable" @bind-Value="_selectedShareable" ToStringFunc="@(content => (UI.EnglishLocale[content]?.AppTitle ?? content.ToString()).Replace("<br/>", " "))" Variant="Variant.Outlined" Style="width:300px;">
                    @foreach (var content in new Content[] { Content.Membership, Content.Opportunity202407, Content.MoneyChallenge, Content.MoneyChallengeFAQ, Content.CreditRestoration, Content.HealthShare, Content.KeysToHomeOwnership, Content.TrustMyAssets, Content.RealEstatePros })
                    {
                        <MudSelectItem Value="@content" />
                    }
                </MudSelect>
                @ContentView(_selectedShareable)
            </MudStack>
        </MudCardContent>
    </MudCard>
    <MudDivider/>
    <Collapsable Title="GivBux Training">
        <MudCard>
            <MudCardContent>
                <MudStack Spacing="3">
                    <MudSelect T="Content" Label="Shareable" @bind-Value="_selectedGivBuxTraining" ToStringFunc="@(content => (UI.EnglishLocale[content]?.AppTitle ?? content.ToString()).Replace("<br/>", " "))" Variant="Variant.Outlined" Style="width:300px;">
                        @foreach (var content in new Content[] { Content.GivBuxAccountSetup, Content.GivBuxUberDemo })
                        {
                            <MudSelectItem Value="@content" />
                        }
                    </MudSelect>
                    @ContentView(_selectedGivBuxTraining)
                </MudStack>
            </MudCardContent>
        </MudCard>
    </Collapsable>
</MudStack>
@code {
    private Content _selectedShareable = Content.Membership;
    private Content _selectedGivBuxTraining = Content.GivBuxAccountSetup;

    private RenderFragment ContentView(Content content) => __builder =>
    {
        var english = UI.EnglishLocale[content];
        var spanish = UI.SpanishLocale[content];

        @if (spanish != null)
        {
            <ShareableVideoMultilingual Description="@english.AppTitle"
                                        Duration="@english.Duration"
                                        Url="@english.MinimalistUrl()"
                                        Video="Util.GetVideoId(english)"
                                       
                                        EnglishTextToCopy="@($"{Shareable.VideoShareable(english)}")"
                                        EnglishTooltip="Copied!"
                                        EnglishImageUrl="@Constants.GetImageUrl(english.Image ?? Image.MoneyChallengeLogo)"
                                        
                                        SpanishTextToCopy="@($"{Shareable.VideoShareable(spanish)}")"
                                        SpanishTooltip="Copied"
                                        SpanishImageUrl="@Constants.GetImageUrl(spanish.Image ?? Image.MoneyChallengeLogo)" />
        }
        else
        {
            <ShareableVideo Description="@english.AppTitle"
                            Duration="@english.Duration"
                            Url="@english.MinimalistUrl()"
                            Video="Util.GetVideoId(english)"
                            TextToCopy="@($"{Shareable.VideoShareable(english)}")"
                            Tooltip="Copied!"
                            ImageUrl="@Constants.GetImageUrl(english.Image ?? Image.MoneyChallengeLogo)" />
        }
    };
}
