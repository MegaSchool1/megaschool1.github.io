@page "/{Language}/{ContentId}/{MemberId}/{ReferralId}"
@inherits CapturePageBase
@using MegaSchool1.Components
@using MegaSchool1.Model
@inject UISettings UI

<PageTitle>MWR 72-Hour Money Challenge!</PageTitle>

<MudStack Spacing="3" Style="height:100%;">
    <Centered><MudImage Src="@GetImageUrl()" Fluid="true" Width="300" /></Centered>
    <Centered>
        @if (this.Video?.Platform is VideoPlatform.YouTube)
        {
            <EmbeddedVideo YouTube="@Video?.Id" />
        }
        @if (this.Video?.Platform is VideoPlatform.Vimeo)
        {
            <EmbeddedVideo Vimeo="@((Video?.Id, Video?.Hash))" />
        }
        @if (this.Video?.Platform is VideoPlatform.TikTok)
        {
            <EmbeddedVideo TikTok="@((Video?.UserHandle, Video?.Id))" />
        }
    </Centered>
    @if (!string.IsNullOrWhiteSpace(this.Video?.DownloadUrl))
    {
        <Centered><ExternalLink Text="Download" Href="@this.Video?.DownloadUrl" /></Centered>
    }
    @if (DateTimeOffset.Now <= Video?.Event?.StartDate)
    {
        @if (!string.IsNullOrWhiteSpace(this.Video?.Event?.Header))
        {
            <MudText Align="Align.Center" Color="Color.Secondary">@Video?.Event?.Header</MudText>
        }
        <MudText Align="Align.Center"><ExternalLink Text="@Video?.Event?.ShareableHeader" Href="@Video?.Event?.Link" /> <br /> @($"{Video?.Event?.StartDate:dddd, MMMM d} @ {Video?.Event?.StartDate?.ToOffset(TimeZoneInfo.Local.BaseUtcOffset): h:mm tt} {TimeZoneInfo.Local.StandardName}")</MudText>
    }
    <br />
    <Centered><MudText Style="color:white;" Align="Align.Center">@((DateTimeOffset.Now <= Video?.PromoExpiration && Video?.Promo != null ? Video?.Promo : "To get started or ask questions, text"))<br /><br />'@ReferralId' to @QMDPhoneNumber</MudText></Centered>
    <MudSpacer/>
</MudStack>

@code {
    [Parameter]
    public string ContentId { get; set; } = Content.MoneyChallenge.ToString();

    private Content ContentValue => Enum.Parse<Content>(this.ContentId);

    private VideoResource? Video => this.Language == Spanish ? UI.SpanishLocale[ContentValue] : UI.EnglishLocale[ContentValue];

    private string GetImageUrl() => Constants.GetImageUrl(Video?.CapturePageImage ?? Video?.Image ?? Image.MoneyChallengeTransparent);
}
